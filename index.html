<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lawyer Reader</title>
<style>
body { font-family: Arial,sans-serif; margin:0; background:#f5f5f5; color:#333; transition: background .3s,color .3s;}
header { background:#222;color:#fff;padding:1rem;text-align:center;font-size:1.2rem;position:relative;}
#theme-toggle, #cache-size-btn { position:absolute; top:1rem; background:none;border:none;color:#fff;font-size:1.2rem;cursor:pointer;}
#theme-toggle { right:1rem;}
#cache-size-btn { right:3rem;}
nav { display:flex; justify-content:center; background:#444; flex-wrap:wrap;}
nav button { background:#444; border:none; color:#fff; padding:.75rem 1rem; cursor:pointer; font-size:.9rem; transition:background .3s;}
nav button.active { background:#007bff;}
.tab-content { display:none; padding:1rem;}
.tab-content.active { display:block;}
.card { background:#fff;margin:1rem 0;padding:1rem;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);transition:background .3s,color .3s;}
.card h2 { font-size:1rem; margin:0 0 .5rem 0;}
.card p { font-size:.9rem;color:#555;}
.card a { display:inline-block;margin-top:.5rem;margin-right:.5rem;padding:.5rem 1rem;background:#007bff;color:#fff;text-decoration:none;border-radius:5px;font-size:.85rem;transition: background .3s,color .3s;}
.card a:hover { background:#0056b3;}
.toolbar { margin-top:.5rem;}
body.dark { background:#121212; color:#eee;}
body.dark header { background:#000; color:#fff;}
body.dark nav { background:#222;}
body.dark nav button { background:#222; color:#ddd;}
body.dark nav button.active { background:#007bff; color:#fff;}
body.dark .card { background:#1e1e1e;color:#ddd;box-shadow:0 2px 6px rgba(255,255,255,.05);}
body.dark .card p { color:#bbb;}
body.dark .card a { background:#3399ff; color:#fff;}
body.dark .card a:hover { background:#66ccff;}
</style>
</head>
<body>
<header>
‚öñÔ∏è Lawyer Reader
<button id="cache-size-btn" title="Cache Size">üíæ</button>
<button id="theme-toggle">üåô</button>
</header>

<nav>
<button class="tab-btn active" data-tab="lawweb">LawWeb</button>
<button class="tab-btn" data-tab="livelaw">LiveLaw</button>
<button class="tab-btn" data-tab="verdictum">Verdictum</button>
<button class="tab-btn" data-tab="ipleaders">iPleaders</button>
<button class="tab-btn" data-tab="barbench">Bar & Bench</button>
<button class="tab-btn" data-tab="supremetoday">SupremeToday</button>
<button class="tab-btn" data-tab="scconline">SCC Online</button>
<button class="tab-btn" data-tab="favorites">‚≠ê Favorites</button>
</nav>

<div id="lawweb" class="tab-content active"><div id="lawweb-container">Loading...</div></div>
<div id="livelaw" class="tab-content"><div id="livelaw-container">Loading...</div></div>
<div id="verdictum" class="tab-content"><div id="verdictum-container">Loading...</div></div>
<div id="ipleaders" class="tab-content"><div id="ipleaders-container">Loading...</div></div>
<div id="barbench" class="tab-content"><div id="barbench-container">Loading...</div></div>
<div id="supremetoday" class="tab-content"><div id="supremetoday-container">Loading...</div></div>
<div id="scconline" class="tab-content"><div id="scconline-container">Loading...</div></div>
<div id="favorites" class="tab-content"><div id="favorites-container">No favorites saved.</div></div>

<script>
// --- Theme ---
const toggleBtn = document.getElementById("theme-toggle");
const cacheBtn = document.getElementById("cache-size-btn");
function applyTheme(theme){
  document.body.classList.toggle("dark",theme==="dark");
  toggleBtn.textContent = theme==="dark"?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",theme);
  updateCardsTheme();
}
toggleBtn.addEventListener("click",()=>{const cur=document.body.classList.contains("dark")?"dark":"light";applyTheme(cur==="dark"?"light":"dark");});
applyTheme(localStorage.getItem("theme")||"light");

function updateCardsTheme(){
  document.querySelectorAll('.card').forEach(card=>{card.classList.toggle('dark', document.body.classList.contains('dark'));});
}

// --- Tabs ---
const buttons=document.querySelectorAll(".tab-btn");
const tabs=document.querySelectorAll(".tab-content");
buttons.forEach(btn=>{btn.addEventListener("click",()=>{
  buttons.forEach(b=>b.classList.remove("active"));
  tabs.forEach(t=>t.classList.remove("active"));
  btn.classList.add("active");
  document.getElementById(btn.dataset.tab).classList.add("active");
})});

// --- Favorites ---
function saveFavorite(title, link, desc){
  let favs=JSON.parse(localStorage.getItem("favorites"))||[];
  favs.push({title,link,desc});
  localStorage.setItem("favorites",JSON.stringify(favs));
  loadFavorites();
  updateCacheSize();
  alert("Saved to favorites!");
}
function loadFavorites(){
  let favs=JSON.parse(localStorage.getItem("favorites"))||[];
  const container=document.getElementById("favorites-container");
  if(favs.length===0){container.innerHTML="No favorites saved.";return;}
  container.innerHTML="";
  favs.forEach(f=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h2>${f.title}</h2><p>${f.desc.substring(0,150)}...</p><div class="toolbar"><a href="${f.link}" target="_blank">Read More</a></div>`;
    container.appendChild(card);
  });
}

// --- Cache size ---
function getLocalStorageSize(){
  let total=0;
  for(let key in localStorage){
    if(localStorage.hasOwnProperty(key)){
      total += localStorage[key].length;
    }
  }
  total = total * 2; // 2 bytes per char
  if(total<1024) return total+" B";
  else if(total<1024*1024) return (total/1024).toFixed(2)+" KB";
  else return (total/(1024*1024)).toFixed(2)+" MB";
}
function updateCacheSize(){ cacheBtn.textContent="üíæ "+getLocalStorageSize(); }
cacheBtn.addEventListener("click",()=>{ alert("Approximate cached data: "+getLocalStorageSize()); });
updateCacheSize();

// --- Fetch RSS ---
async function fetchRSS(rssUrl, containerId, storageKey){
  const container=document.getElementById(containerId);
  // Load cached
  let cached=JSON.parse(localStorage.getItem(storageKey))||[];
  if(cached.length>0){
    container.innerHTML="";
    cached.forEach(f=>{createCard(container,f.title,f.link,f.desc,storageKey)});
  }
  // Fetch latest
  try{
    const response=await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
    const data=await response.json();
    const parser=new DOMParser();
    const xml=parser.parseFromString(data.contents,"application/xml");
    const items=xml.querySelectorAll("item");
    let results=[];
    container.innerHTML="";
    items.forEach((item,idx)=>{
      if(idx<10){
        const title=item.querySelector("title")?.textContent||"No title";
        const link=item.querySelector("link")?.textContent||"#";
        const desc=item.querySelector("description")?.textContent||"";
        results.push({title,link,desc});
        createCard(container,title,link,desc,storageKey);
      }
    });
    localStorage.setItem(storageKey,JSON.stringify(results));
    updateCacheSize();
  }catch(err){ console.error("RSS fetch failed:",err); container.innerHTML+="<p>‚ö†Ô∏è Could not load updates. Showing cached content if available.</p>"; }
}

// --- Create card ---
function createCard(container,title,link,desc,storageKey){
  const card=document.createElement("div"); card.className="card";
  card.innerHTML=`<h2>${title}</h2><p>${desc.substring(0,150)}...</p>
    <div class="toolbar">
    <a href="${link}" target="_blank">Read More</a>
    <a href="https://www.printfriendly.com/p/g?url=${encodeURIComponent(link)}" target="_blank">PDF</a>
    <a href="https://gemini.google.com/?q=${encodeURIComponent(title+' site:indiankanoon.org')}" target="_blank">Find CaseLaw</a>
    <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(title+' '+link)}" target="_blank">WhatsApp</a>
    <a href="https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(title)}" target="_blank">Telegram</a>
    <a href="#" onclick="saveFavorite('${title}','${link}','${desc.replace(/'/g," ")}');return false;">‚≠ê Favorite</a>
    </div>`;
  container.appendChild(card);
  if(document.body.classList.contains("dark")) card.classList.add("dark");
}

// --- All feeds ---
const feeds = [
  {url:"https://www.lawweb.in/feeds/posts/default?alt=rss",container:"lawweb-container",key:"lawweb"},
  {url:"https://www.livelaw.in/rssfeed",container:"livelaw-container",key:"livelaw"},
  {url:"https://www.verdictum.in/rss",container:"verdictum-container",key:"verdictum"},
  {url:"https://blog.ipleaders.in/feed/",container:"ipleaders-container",key:"ipleaders"},
  {url:"https://www.barandbench.com/rss",container:"barbench-container",key:"barbench"},
  {url:"https://supremetoday.ai/feed",container:"supremetoday-container",key:"supremetoday"},
  {url:"https://www.scconline.com/feed/",container:"scconline-container",key:"scconline"}
];

// Load all feeds in background
feeds.forEach(f=>fetchRSS(f.url,f.container,f.key));
loadFavorites();
</script>
</body>
</html>
